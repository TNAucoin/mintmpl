"""Tests for {{ package_name }} core functionality."""

import pytest
from {{ package_name }} import {{ class_name }}
from {{ package_name }}.config import Config


class Test{{ class_name }}:
    """Test suite for {{ class_name }} class."""

    def test_initialization(self):
        """Test {{ class_name }} initialization."""
        service = {{ class_name }}()
        assert service is not None
        assert isinstance(service.config, Config)

    def test_initialization_with_config(self):
        """Test {{ class_name }} initialization with custom config."""
        config = Config(database_name="test_db")
        service = {{ class_name }}(config)
        assert service.config.database_name == "test_db"

    def test_process_data(self):
        """Test basic data processing in {{ class_name }}."""
        service = {{ class_name }}()
        result = service.process_data("test input")

        assert result["status"] == "success"
        assert result["data"] == "TEST INPUT"
        assert result["metadata"]["service"] == "{{ package_name }}"
        assert result["metadata"]["database"] == "{{ database_name }}"

    def test_process_data_invalid_input(self):
        """Test {{ class_name }} with invalid input."""
        service = {{ class_name }}()

        with pytest.raises(ValueError):
            service.process_data("invalid@#$%input")

    def test_process_data_caching(self):
        """Test that {{ class_name }} caches results."""
        service = {{ class_name }}()

        result1 = service.process_data("cached data")
        result2 = service.process_data("cached data")

        # Results should be identical (from cache)
        assert result1 is result2

    def test_batch_process(self):
        """Test batch processing in {{ class_name }}."""
        service = {{ class_name }}()
        items = ["item1", "item2", "item3"]

        results = service.batch_process(items)

        assert len(results) == 3
        assert all(r["status"] == "success" for r in results)
        assert results[0]["data"] == "ITEM1"
        assert results[1]["data"] == "ITEM2"
        assert results[2]["data"] == "ITEM3"

    def test_clear_cache(self):
        """Test cache clearing in {{ class_name }}."""
        service = {{ class_name }}()

        # Process some data to populate cache
        service.process_data("test")
        assert len(service._cache) > 0

        # Clear cache
        service.clear_cache()
        assert len(service._cache) == 0

    def test_get_stats(self):
        """Test getting service statistics."""
        service = {{ class_name }}()
        stats = service.get_stats()

        assert stats["service_name"] == "{{ package_name }}"
        assert stats["database"] == "{{ database_name }}"
        assert "cache_size" in stats
