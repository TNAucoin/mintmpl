using System;
using System.Threading.Tasks;
using FluentAssertions;
using Microsoft.Extensions.Logging;
using Moq;
using {{ namespace_name }}.Models;
using Xunit;

namespace {{ namespace_name }}.Tests;

/// <summary>
/// Unit tests for the ServiceClient class.
/// </summary>
public sealed class {{ class_name }}Tests : IDisposable
{
    private readonly Configuration _configuration;
    private readonly Mock<ILogger<{{ class_name }}>> _loggerMock;

    public {{ class_name }}Tests()
    {
        _configuration = new Configuration
        {
            ApiKey = "test-api-key",
            BaseUrl = "https://test.example.com",
            Timeout = TimeSpan.FromSeconds(10),
            MaxRetries = 2
        };

        _loggerMock = new Mock<ILogger<{{ class_name }}>>();
    }

    [Fact]
    public void Constructor_WithNullConfiguration_ThrowsArgumentNullException()
    {
        // Act
        Action act = () => new {{ class_name }}(null!);

        // Assert
        act.Should().Throw<ArgumentNullException>()
            .WithParameterName("configuration");
    }

    [Fact]
    public void Constructor_WithValidConfiguration_CreatesInstance()
    {
        // Act
        using var client = new {{ class_name }}(_configuration, _loggerMock.Object);

        // Assert
        client.Should().NotBeNull();
    }

    [Fact]
    public async Task GetDataAsync_WithValidResourceId_ReturnsData()
    {
        // Arrange
        using var client = new {{ class_name }}(_configuration, _loggerMock.Object);
        const string resourceId = "test-resource";

        // Act
        var result = await client.GetDataAsync(resourceId);

        // Assert
        result.Should().NotBeNullOrEmpty();
        result.Should().Contain(resourceId);
        result.Should().Contain(_configuration.BaseUrl);
    }

    [Theory]
    [InlineData(null)]
    [InlineData("")]
    [InlineData("   ")]
    public async Task GetDataAsync_WithInvalidResourceId_ThrowsArgumentException(string? resourceId)
    {
        // Arrange
        using var client = new {{ class_name }}(_configuration, _loggerMock.Object);

        // Act
        Func<Task> act = async () => await client.GetDataAsync(resourceId!);

        // Assert
        await act.Should().ThrowAsync<ArgumentException>()
            .WithParameterName("resourceId");
    }

    [Fact]
    public async Task PostDataAsync_WithValidParameters_ReturnsTrue()
    {
        // Arrange
        using var client = new {{ class_name }}(_configuration, _loggerMock.Object);
        const string resourceId = "test-resource";
        const string data = "test-data";

        // Act
        var result = await client.PostDataAsync(resourceId, data);

        // Assert
        result.Should().BeTrue();
    }

    [Theory]
    [InlineData(null, "data")]
    [InlineData("", "data")]
    [InlineData("resource", null)]
    [InlineData("resource", "")]
    public async Task PostDataAsync_WithInvalidParameters_ThrowsArgumentException(
        string? resourceId,
        string? data)
    {
        // Arrange
        using var client = new {{ class_name }}(_configuration, _loggerMock.Object);

        // Act
        Func<Task> act = async () => await client.PostDataAsync(resourceId!, data!);

        // Assert
        await act.Should().ThrowAsync<ArgumentException>();
    }

    [Fact]
    public async Task ValidateConnectionAsync_WithValidConfiguration_ReturnsTrue()
    {
        // Arrange
        using var client = new {{ class_name }}(_configuration, _loggerMock.Object);

        // Act
        var result = await client.ValidateConnectionAsync();

        // Assert
        result.Should().BeTrue();
    }

    [Fact]
    public async Task GetDataAsync_AfterDispose_ThrowsObjectDisposedException()
    {
        // Arrange
        var client = new {{ class_name }}(_configuration, _loggerMock.Object);
        client.Dispose();

        // Act
        Func<Task> act = async () => await client.GetDataAsync("test");

        // Assert
        await act.Should().ThrowAsync<ObjectDisposedException>();
    }

    [Fact]
    public void Dispose_CalledMultipleTimes_DoesNotThrow()
    {
        // Arrange
        var client = new {{ class_name }}(_configuration, _loggerMock.Object);

        // Act
        Action act = () =>
        {
            client.Dispose();
            client.Dispose();
        };

        // Assert
        act.Should().NotThrow();
    }

    public void Dispose()
    {
        // Cleanup if needed
    }
}
