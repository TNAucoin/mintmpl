using System;
using FluentAssertions;
using {{ namespace_name }}.Models;
using Xunit;

namespace {{ namespace_name }}.Tests;

/// <summary>
/// Unit tests for the Configuration class.
/// </summary>
public sealed class ConfigurationTests
{
    [Fact]
    public void Validate_WithValidConfiguration_DoesNotThrow()
    {
        // Arrange
        var config = new Configuration
        {
            ApiKey = "test-key",
            BaseUrl = "https://api.example.com",
            Timeout = TimeSpan.FromSeconds(30),
            MaxRetries = 3
        };

        // Act
        Action act = () => config.Validate();

        // Assert
        act.Should().NotThrow();
    }

    [Fact]
    public void Validate_WithEmptyApiKey_ThrowsInvalidOperationException()
    {
        // Arrange
        var config = new Configuration
        {
            ApiKey = "",
            BaseUrl = "https://api.example.com"
        };

        // Act
        Action act = () => config.Validate();

        // Assert
        act.Should().Throw<InvalidOperationException>()
            .WithMessage("*API key*");
    }

    [Fact]
    public void Validate_WithEmptyBaseUrl_ThrowsInvalidOperationException()
    {
        // Arrange
        var config = new Configuration
        {
            ApiKey = "test-key",
            BaseUrl = ""
        };

        // Act
        Action act = () => config.Validate();

        // Assert
        act.Should().Throw<InvalidOperationException>()
            .WithMessage("*Base URL*");
    }

    [Theory]
    [InlineData("not-a-url")]
    [InlineData("ftp://invalid.com")]
    [InlineData("relative/path")]
    public void Validate_WithInvalidBaseUrl_ThrowsInvalidOperationException(string baseUrl)
    {
        // Arrange
        var config = new Configuration
        {
            ApiKey = "test-key",
            BaseUrl = baseUrl
        };

        // Act
        Action act = () => config.Validate();

        // Assert
        act.Should().Throw<InvalidOperationException>()
            .WithMessage("*valid absolute URI*");
    }

    [Fact]
    public void Validate_WithZeroTimeout_ThrowsInvalidOperationException()
    {
        // Arrange
        var config = new Configuration
        {
            ApiKey = "test-key",
            BaseUrl = "https://api.example.com",
            Timeout = TimeSpan.Zero
        };

        // Act
        Action act = () => config.Validate();

        // Assert
        act.Should().Throw<InvalidOperationException>()
            .WithMessage("*Timeout*");
    }

    [Fact]
    public void Validate_WithNegativeMaxRetries_ThrowsInvalidOperationException()
    {
        // Arrange
        var config = new Configuration
        {
            ApiKey = "test-key",
            BaseUrl = "https://api.example.com",
            MaxRetries = -1
        };

        // Act
        Action act = () => config.Validate();

        // Assert
        act.Should().Throw<InvalidOperationException>()
            .WithMessage("*Max retries*");
    }

    [Fact]
    public void DefaultValues_AreSetCorrectly()
    {
        // Arrange & Act
        var config = new Configuration();

        // Assert
        config.BaseUrl.Should().Be("https://api.example.com");
        config.Timeout.Should().Be(TimeSpan.FromSeconds(30));
        config.MaxRetries.Should().Be(3);
        config.UseCompression.Should().BeTrue();
    }
}
